import{d as K,r as B,c as _,w as a,a as Q,x as C,o as i,b as o,u as l,h as L,I as x,e as E,f as k,y as v,i as W,l as f,s as m,t as X,F as b,z as Y,A as Z,B as $,v as p,C as S,D as A,j as ee,E as V,G as te}from"./index-CnB-i3jf.js";import{C as h}from"./confconnect-DJ7JF4nv.js";const oe="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M403.13 96H156.87a44.9 44.9 0 00-33.68 15.27 15.88 15.88 0 00-1.91 2.7L32 247.75a16 16 0 000 16.5l89.15 133.57a16.24 16.24 0 002 2.88 44.89 44.89 0 0033.7 15.3h246.28A44.92 44.92 0 00448 371.13V140.87A44.92 44.92 0 00403.13 96zM348 311a16 16 0 11-22.63 22.62L271.67 280 218 333.65A16 16 0 01195.35 311L249 257.33l-53.69-53.69A16 16 0 01218 181l53.69 53.7 53.67-53.7A16 16 0 01348 203.64l-53.7 53.69z'/></svg>",le="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' d='M464 128L240 384l-96-96M144 384l-96-96M368 128L232 284' class='ionicon-fill-none ionicon-stroke-width'/></svg>",H="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M432 448a15.92 15.92 0 01-11.31-4.69l-352-352a16 16 0 0122.62-22.62l352 352A16 16 0 01432 448zM248 315.85l-51.79-51.79a2 2 0 00-3.39 1.69 64.11 64.11 0 0053.49 53.49 2 2 0 001.69-3.39zM264 196.15L315.87 248a2 2 0 003.4-1.69 64.13 64.13 0 00-53.55-53.55 2 2 0 00-1.72 3.39z'/><path d='M491 273.36a32.2 32.2 0 00-.1-34.76c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.68 96a226.54 226.54 0 00-71.82 11.79 4 4 0 00-1.56 6.63l47.24 47.24a4 4 0 003.82 1.05 96 96 0 01116 116 4 4 0 001.05 3.81l67.95 68a4 4 0 005.4.24 343.81 343.81 0 0067.24-77.4zM256 352a96 96 0 01-93.3-118.63 4 4 0 00-1.05-3.81l-66.84-66.87a4 4 0 00-5.41-.23c-24.39 20.81-47 46.13-67.67 75.72a31.92 31.92 0 00-.64 35.54c26.41 41.33 60.39 76.14 98.28 100.65C162.06 402 207.92 416 255.68 416a238.22 238.22 0 0072.64-11.55 4 4 0 001.61-6.64l-47.47-47.46a4 4 0 00-3.81-1.05A96 96 0 01256 352z'/></svg>",ae="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M392 80H232a56.06 56.06 0 00-56 56v104h153.37l-52.68-52.69a16 16 0 0122.62-22.62l80 80a16 16 0 010 22.62l-80 80a16 16 0 01-22.62-22.62L329.37 272H176v104c0 32.05 33.79 56 64 56h152a56.06 56.06 0 0056-56V136a56.06 56.06 0 00-56-56zM80 240a16 16 0 000 32h96v-32z'/></svg>",se="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M160 256a16 16 0 0116-16h144V136c0-32-33.79-56-64-56H104a56.06 56.06 0 00-56 56v240a56.06 56.06 0 0056 56h160a56.06 56.06 0 0056-56V272H176a16 16 0 01-16-16zM459.31 244.69l-80-80a16 16 0 00-22.62 22.62L409.37 240H320v32h89.37l-52.68 52.69a16 16 0 1022.62 22.62l80-80a16 16 0 000-22.62z'/></svg>",ne="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='44' d='M358.62 129.28L86.49 402.08 70 442l39.92-16.49 272.8-272.13-24.1-24.1zM413.07 74.84l-11.79 11.78 24.1 24.1 11.79-11.79a16.51 16.51 0 000-23.34l-.75-.75a16.51 16.51 0 00-23.35 0z' class='ionicon-fill-none'/></svg>",re="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M296 64h-80a7.91 7.91 0 00-8 8v24h96V72a7.91 7.91 0 00-8-8z' class='ionicon-fill-none'/><path d='M432 96h-96V72a40 40 0 00-40-40h-80a40 40 0 00-40 40v24H80a16 16 0 000 32h17l19 304.92c1.42 26.85 22 47.08 48 47.08h184c26.13 0 46.3-19.78 48-47l19-305h17a16 16 0 000-32zM192.57 416H192a16 16 0 01-16-15.43l-8-224a16 16 0 1132-1.14l8 224A16 16 0 01192.57 416zM272 400a16 16 0 01-32 0V176a16 16 0 0132 0zm32-304h-96V72a7.91 7.91 0 018-8h80a7.91 7.91 0 018 8zm32 304.57A16 16 0 01320 416h-.58A16 16 0 01304 399.43l8-224a16 16 0 1132 1.14z'/></svg>",ie=["id"],ue={class:"post-data"},ce={class:"user-name"},de={key:0,class:"created-time"},ve={key:1,class:"created-time"},me=["onSubmit"],fe=f("b",null,"B",-1),ge=f("i",null,"I",-1),pe=["innerHTML"],_e=f("b",null,"B",-1),he=f("i",null,"I",-1),ye=K({__name:"Forum",setup(we){console.log(document.cookie),Q();const I=B(0),s=B({success:"",message:"",user:null,list:[],formEdit:{user:"",post:""},formCreate:{user:"",post:""}}),w=t=>new Date(t),y=t=>{I.value=t};function T(){h.post("/logout",null).then(t=>{localStorage.removeItem("user"),window.location.replace("/forum")})}function N(){window.location.replace("/login")}function D(t){const e=document.getElementById(t).getElementsByClassName("native-textarea")[0],n=e.selectionStart,u=e.selectionEnd;return[n,u]}function g(t,e){const n=D(t),u=document.getElementById(t).getElementsByClassName("native-textarea")[0];u.value=u.value.slice(0,n[0])+"[".concat(e,"]").concat(u.value.slice(n[0],n[1]),"[/").concat(e,"]")+u.value.slice(n[1]),t=="edit"?s.value.formEdit.post=u.value:s.value.formCreate.post=u.value}function M(t){return s.value.user!=null?s.value.user.name==t.user:!1}const F=t=>[{text:"Отмена"},{text:"Удалить",handler:()=>{G(t)}}],P=async t=>{const e=s.value.list[t];await(await te.create({header:e.user,message:'Вы точно хотите удалить сообщение "'.concat(e.post,'"'),buttons:F(t),cssClass:"alertEdit"})).present()},R=[[" ","&nbsp;"],["\n","\n<br>\n"],["[spoiler]",'<span class="spoiler" onclick="this.classList.toggle(\'visible\');">'],["[/spoiler]","</span>"],["[b]","<b>"],["[/b]","</b>"],["[i]","<i>"],["[/i]","</i>"]],j=t=>{for(let e of R)t=t.replaceAll(e[0],e[1]);return t},q=()=>{try{h.post("/forum",s.value.formCreate).then(t=>{document.getElementById("addPost").reset(),document.querySelector(".post-form textarea").value="",t.post="",t.user="",c(),c(!0)})}catch(t){s.value.error=t}},O=t=>{try{h.put("/forum/".concat(s.value.list[t].id),s.value.formEdit).then(e=>{e.post="",e.user="",y(0),c()})}catch(e){s.value.error=e}},c=(t=!1)=>{try{h.get("/forum").then(e=>{if(e.data.error!=null)s.value.error=e.data.error;else{let n=localStorage.getItem("user");if(n!=null&&(s.value.user=JSON.parse(n),s.value.formCreate.user=s.value.user.name),s.value.success=e.data.success,s.value.message=e.data.message,s.value.list=e.data.list,t){const u=s.value.list.length;window.location.replace("forum#".concat(s.value.list[u-2].id))}}})}catch(e){console.log(e)}},G=t=>{try{h.delete("/forum/".concat(s.value.list[t].id)).then(e=>{e.post="",e.user="",c()})}catch(e){console.log(e.toString())}};c(),c(!0),setInterval(function(){document.activeElement.tagName.toLowerCase()=="textarea"?c():c(!0)},1e4);function J(){return s.value.user!=null?" is_auth":""}return(t,e)=>{const n=C("ion-button"),u=C("ion-text"),U=C("ion-refresher");return i(),_(U,null,{default:a(()=>[o(l(ee),null,{default:a(()=>[o(l(L),{translucent:!0},{default:a(()=>[o(l(x),null,{default:a(()=>[o(l(E),null,{default:a(()=>[k("Forum")]),_:1}),s.value.user!=null?(i(),_(n,{key:0,onClick:T},{default:a(()=>[o(l(v),{icon:l(se),slot:"icon-only"},null,8,["icon"])]),_:1})):(i(),_(n,{key:1,onClick:N},{default:a(()=>[o(l(v),{icon:l(ae),slot:"icon-only"},null,8,["icon"])]),_:1}))]),_:1})]),_:1}),o(l(W),{fullscreen:!0},{default:a(()=>[o(l(L),{collapse:"condense"},{default:a(()=>[o(l(x),null,{default:a(()=>[o(l(E),{size:"large"},{default:a(()=>[k("Forum")]),_:1})]),_:1})]),_:1}),f("div",{class:Y("forum"+J())},[(i(!0),m(b,null,X(s.value.list,(r,z)=>(i(),m("div",{class:"message",id:r.id},[f("div",ue,[f("span",ce,p(r.user),1),r.created_at==r.updated_at?(i(),m("span",de,p(w(r.created_at).toLocaleDateString("ru-Ru"))+" "+p(w(r.created_at).toLocaleTimeString("ru-Ru")),1)):(i(),m("span",ve,"ред. "+p(w(r.updated_at).toLocaleDateString("ru-Ru"))+" "+p(w(r.updated_at).toLocaleTimeString("ru-Ru")),1))]),I.value==r.id?(i(),m("form",{key:0,onSubmit:A(d=>O(z),["prevent"])},[o(l(S),{id:"edit",class:"edit-text",value:r.post,required:"",rows:"5",onInput:d=>s.value.formEdit.post=d.target.value},{default:a(()=>[o(l(x),{class:"edit-text-toolbar",slot:"start"},{default:a(()=>[o(n,{class:"bold-text",onClick:e[0]||(e[0]=d=>g("edit","b"))},{default:a(()=>[fe]),_:1}),o(n,{class:"italic-text",onClick:e[1]||(e[1]=d=>g("edit","i"))},{default:a(()=>[ge]),_:1}),o(n,{class:"spoiler-text",onClick:e[2]||(e[2]=d=>g("edit","spoiler"))},{default:a(()=>[o(l(v),{icon:l(H),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:2},1032,["value","onInput"]),o(n,{class:"done-post",type:"submit",color:"secondary"},{default:a(()=>[o(l(v),{icon:l(le),slot:"icon-only"},null,8,["icon"])]),_:1}),o(n,{class:"back-post",color:"warning",onClick:d=>{y(0),s.value.formEdit.post=""}},{default:a(()=>[o(l(v),{icon:l(oe),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])],40,me)):(i(),m(b,{key:1},[f("div",{innerHTML:j(r.post),class:"textarea-disabled"},null,8,pe),M(r)?(i(),_(n,{key:0,class:"delete-post",color:"danger",onClick:d=>P(z)},{default:a(()=>[o(l(v),{icon:l(re),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])):V("",!0),M(r)?(i(),_(n,{key:1,class:"edit-post",color:"secondary",onClick:d=>{y(r.id),s.value.formEdit.post=r.post}},{default:a(()=>[o(l(v),{icon:l(ne),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])):V("",!0)],64))],8,ie))),256))],2),s.value.user==null?(i(),m(b,{key:0},[],64)):(i(),m("form",{key:1,onSubmit:A(q,["prevent"]),id:"addPost"},[o(l(Z),{class:"add-post"},{default:a(()=>[o(l($),null,{default:a(()=>[o(u,null,{default:a(()=>[k(p(s.value.user.name),1)]),_:1})]),_:1}),o(l($),null,{default:a(()=>[o(l(S),{id:"post-text",class:"post-form",required:"",rows:"5",onInput:e[6]||(e[6]=r=>s.value.formCreate.post=r.target.value)},{default:a(()=>[o(l(x),{class:"edit-text-toolbar",slot:"start"},{default:a(()=>[o(n,{class:"bold-text",onClick:e[3]||(e[3]=r=>g("post-text","b"))},{default:a(()=>[_e]),_:1}),o(n,{class:"italic-text",onClick:e[4]||(e[4]=r=>g("post-text","i"))},{default:a(()=>[he]),_:1}),o(n,{class:"spoiler-text",onClick:e[5]||(e[5]=r=>g("post-text","spoiler"))},{default:a(()=>[o(l(v),{icon:l(H),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1}),o(n,{class:"submit",type:"submit"},{default:a(()=>[k("Send")]),_:1})]),_:1})],32))]),_:1})]),_:1})]),_:1})}}});export{ye as default};
