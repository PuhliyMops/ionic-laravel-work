import{d as F,r as b,c as N,w as n,u as s,a as P,x as R,o as c,b as a,I as w,e as k,f as x,h as y,l as u,s as d,t as q,F as I,y as j,z as M,A as O,B as z,C as B,i as U,j as G,v as m,D as v,E as J}from"./index-DHP3V8Il.js";import{C as f}from"./confconnect-DyJNFkJf.js";const K="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M403.13 96H156.87a44.9 44.9 0 00-33.68 15.27 15.88 15.88 0 00-1.91 2.7L32 247.75a16 16 0 000 16.5l89.15 133.57a16.24 16.24 0 002 2.88 44.89 44.89 0 0033.7 15.3h246.28A44.92 44.92 0 00448 371.13V140.87A44.92 44.92 0 00403.13 96zM348 311a16 16 0 11-22.63 22.62L271.67 280 218 333.65A16 16 0 01195.35 311L249 257.33l-53.69-53.69A16 16 0 01218 181l53.69 53.7 53.67-53.7A16 16 0 01348 203.64l-53.7 53.69z'/></svg>",Q="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' d='M464 128L240 384l-96-96M144 384l-96-96M368 128L232 284' class='ionicon-fill-none ionicon-stroke-width'/></svg>",W="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M432 448a15.92 15.92 0 01-11.31-4.69l-352-352a16 16 0 0122.62-22.62l352 352A16 16 0 01432 448zM248 315.85l-51.79-51.79a2 2 0 00-3.39 1.69 64.11 64.11 0 0053.49 53.49 2 2 0 001.69-3.39zM264 196.15L315.87 248a2 2 0 003.4-1.69 64.13 64.13 0 00-53.55-53.55 2 2 0 00-1.72 3.39z'/><path d='M491 273.36a32.2 32.2 0 00-.1-34.76c-26.46-40.92-60.79-75.68-99.27-100.53C349 110.55 302 96 255.68 96a226.54 226.54 0 00-71.82 11.79 4 4 0 00-1.56 6.63l47.24 47.24a4 4 0 003.82 1.05 96 96 0 01116 116 4 4 0 001.05 3.81l67.95 68a4 4 0 005.4.24 343.81 343.81 0 0067.24-77.4zM256 352a96 96 0 01-93.3-118.63 4 4 0 00-1.05-3.81l-66.84-66.87a4 4 0 00-5.41-.23c-24.39 20.81-47 46.13-67.67 75.72a31.92 31.92 0 00-.64 35.54c26.41 41.33 60.39 76.14 98.28 100.65C162.06 402 207.92 416 255.68 416a238.22 238.22 0 0072.64-11.55 4 4 0 001.61-6.64l-47.47-47.46a4 4 0 00-3.81-1.05A96 96 0 01256 352z'/></svg>",X="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='44' d='M358.62 129.28L86.49 402.08 70 442l39.92-16.49 272.8-272.13-24.1-24.1zM413.07 74.84l-11.79 11.78 24.1 24.1 11.79-11.79a16.51 16.51 0 000-23.34l-.75-.75a16.51 16.51 0 00-23.35 0z' class='ionicon-fill-none'/></svg>",Y="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M296 64h-80a7.91 7.91 0 00-8 8v24h96V72a7.91 7.91 0 00-8-8z' class='ionicon-fill-none'/><path d='M432 96h-96V72a40 40 0 00-40-40h-80a40 40 0 00-40 40v24H80a16 16 0 000 32h17l19 304.92c1.42 26.85 22 47.08 48 47.08h184c26.13 0 46.3-19.78 48-47l19-305h17a16 16 0 000-32zM192.57 416H192a16 16 0 01-16-15.43l-8-224a16 16 0 1132-1.14l8 224A16 16 0 01192.57 416zM272 400a16 16 0 01-32 0V176a16 16 0 0132 0zm32-304h-96V72a7.91 7.91 0 018-8h80a7.91 7.91 0 018 8zm32 304.57A16 16 0 01320 416h-.58A16 16 0 01304 399.43l8-224a16 16 0 1132 1.14z'/></svg>",Z={class:"forum"},tt=["id"],et={class:"post-data"},at={class:"user-name"},st={key:0,class:"created-time"},ot={key:1,class:"created-time"},lt=["onSubmit"],nt=u("b",null,"B",-1),rt=u("i",null,"I",-1),it=["innerHTML"],mt=F({__name:"Forum",setup(ct){P();const C=b(0),o=b({success:"",message:"",list:[],formEdit:{user:"",post:""},formCreate:{user:"",post:""}}),p=t=>new Date(t),g=t=>{C.value=t};function E(t){const e=document.getElementById(t).getElementsByClassName("native-textarea")[0],r=e.selectionStart,l=e.selectionEnd;return[r,l]}function _(t,e){const r=E(t),l=document.getElementById(t).getElementsByClassName("native-textarea")[0];l.value=l.value.slice(0,r[0])+"[".concat(e,"]").concat(l.value.slice(r[0],r[1]),"[/").concat(e,"]")+l.value.slice(r[1]),o.value.formEdit.post=l.value}const L=t=>[{text:"Отмена"},{text:"Удалить",handler:()=>{H(t)}}],A=async t=>{const e=o.value.list[t];await(await J.create({header:e.user,message:'Вы точно хотите удалить сообщение "'.concat(e.post,'"'),buttons:L(t),cssClass:"alertEdit"})).present()},$=[[" ","&nbsp;"],["\n","\n<br>\n"],["[spoiler]",'<span class="spoiler" onclick="this.classList.toggle(\'visible\');">'],["[/spoiler]","</span>"],["[b]","<b>"],["[/b]","</b>"],["[i]","<i>"],["[/i]","</i>"]],S=t=>{for(let e of $)t=t.replaceAll(e[0],e[1]);return t},T=()=>{try{f.post("/forum",o.value.formCreate).then(t=>{document.getElementById("addPost").reset(),document.querySelector(".post-form textarea").value="",t.post="",t.user="",o.value.list.push(t.data.data);const e=o.value.list.length-1;window.location.replace("forum#".concat(e-1))})}catch(t){o.value.error=t}},V=t=>{try{f.put("/forum/".concat(o.value.list[t].id),o.value.formEdit).then(e=>{e.post="",e.user="",g(0),o.value.list[t].post=e.data.data.post,o.value.list[t].updated_at=e.data.data.updated_at})}catch(e){o.value.error=e}},D=()=>{try{f.get("/forum").then(t=>{t.data.error!=null?o.value.error=t.data.error:(o.value.success=t.data.success,o.value.message=t.data.message,o.value.list=t.data.list)})}catch(t){console.log(t)}},H=t=>{f.delete("/forum/".concat(o.value.list[t].id)).then(e=>{e.post="",e.user="",o.value.list.splice(t,1)})};return D(),(t,e)=>{const r=R("ion-button");return c(),N(s(G),null,{default:n(()=>[a(s(y),{translucent:!0},{default:n(()=>[a(s(w),null,{default:n(()=>[a(s(k),null,{default:n(()=>[x("Forum")]),_:1})]),_:1})]),_:1}),a(s(U),{fullscreen:!0},{default:n(()=>[a(s(y),{collapse:"condense"},{default:n(()=>[a(s(w),null,{default:n(()=>[a(s(k),{size:"large"},{default:n(()=>[x("Forum")]),_:1})]),_:1})]),_:1}),u("div",Z,[(c(!0),d(I,null,q(o.value.list,(l,h)=>(c(),d("div",{class:"message",id:h},[u("div",et,[u("span",at,m(l.user),1),l.created_at==l.updated_at?(c(),d("span",st,m(p(l.created_at).toLocaleDateString("ru-Ru"))+" "+m(p(l.created_at).toLocaleTimeString("ru-Ru")),1)):(c(),d("span",ot,"ред. "+m(p(l.updated_at).toLocaleDateString("ru-Ru"))+" "+m(p(l.updated_at).toLocaleTimeString("ru-Ru")),1))]),C.value==l.id?(c(),d("form",{key:0,onSubmit:B(i=>V(h),["prevent"])},[a(s(z),{id:"edit",class:"edit-text",value:l.post,required:"",rows:"5",onInput:i=>o.value.formEdit.post=i.target.value},{default:n(()=>[a(s(w),{class:"edit-text-toolbar",slot:"start"},{default:n(()=>[a(r,{class:"bold-text",onClick:e[0]||(e[0]=i=>_("edit","b"))},{default:n(()=>[nt]),_:1}),a(r,{class:"italic-text",onClick:e[1]||(e[1]=i=>_("edit","i"))},{default:n(()=>[rt]),_:1}),a(r,{class:"spoiler-text",onClick:e[2]||(e[2]=i=>_("edit","spoiler"))},{default:n(()=>[a(s(v),{icon:s(W),slot:"icon-only"},null,8,["icon"])]),_:1})]),_:1})]),_:2},1032,["value","onInput"]),a(r,{class:"done-post",type:"submit",color:"secondary"},{default:n(()=>[a(s(v),{icon:s(Q),slot:"icon-only"},null,8,["icon"])]),_:1}),a(r,{class:"back-post",color:"warning",onClick:i=>{g(0),o.value.formEdit.post=""}},{default:n(()=>[a(s(v),{icon:s(K),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])],40,lt)):(c(),d(I,{key:1},[u("div",{innerHTML:S(l.post),class:"textarea-disabled"},null,8,it),a(r,{class:"delete-post",color:"danger",onClick:i=>A(h)},{default:n(()=>[a(s(v),{icon:s(Y),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"]),a(r,{class:"edit-post",color:"secondary",onClick:i=>{g(l.id),o.value.formEdit.post=l.post}},{default:n(()=>[a(s(v),{icon:s(X),slot:"icon-only"},null,8,["icon"])]),_:2},1032,["onClick"])],64))],8,tt))),256))]),u("form",{onSubmit:B(T,["prevent"]),id:"addPost"},[a(s(j),{class:"add-post"},{default:n(()=>[a(s(M),null,{default:n(()=>[a(s(O),{class:"username-form",required:"",label:"",placeholder:"Пользователь",modelValue:o.value.formCreate.user,"onUpdate:modelValue":e[3]||(e[3]=l=>o.value.formCreate.user=l)},null,8,["modelValue"])]),_:1}),a(s(M),null,{default:n(()=>[a(s(z),{id:"post-text",class:"post-form",required:"",rows:"5",onInput:e[4]||(e[4]=l=>o.value.formCreate.post=l.target.value)})]),_:1}),a(r,{class:"submit",type:"submit"},{default:n(()=>[x("Send")]),_:1})]),_:1})],32)]),_:1})]),_:1})}}});export{mt as default};
